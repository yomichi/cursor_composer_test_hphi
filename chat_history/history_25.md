### #25

#### In

テストが通りました。実際の計算も通りました。
ここまでを踏まえて、`references/todo.md` と `references/tests/run_calculations.py.md` にあるチェックリストを更新してください。
その後、次のアクションを提案してください。

#### Out

まず、`references/tests/run_calculations.py.md`のチェックリストを更新します。

````markdown:references/tests/run_calculations.py.md
# run_calculations.py のテスト戦略

// ... existing content ...

## 3. テストケースの優先順位

### 1. 基本機能のテスト
- [x] コマンドライン引数の処理
  - [x] デフォルト値の確認
  - [x] カスタム値の確認
  - [x] 型の確認
- [x] HPhi実行の基本機能
  - [x] コマンド実行
  - [x] 出力ファイルの確認

### 2. 入力値の検証
- [x] パラメータの妥当性チェック
  - [x] 作業ディレクトリの存在確認
  - [x] HPhi実行ファイルの確認
- [x] エラー処理
  - [x] 不正なパス
  - [x] 権限エラー

### 3. ファイルシステム操作
- [x] 結果ディレクトリの作成
  - [x] ディレクトリ構造の作成
  - [x] 既存ディレクトリの処理
- [x] 結果ファイルの移動
  - [x] ファイルの移動確認
  - [x] 移動後の内容確認

### 4. エッジケース
- [ ] 実行時エラー
  - [x] HPhi実行失敗
  - [ ] タイムアウト
  - [ ] 中断処理
- [ ] 並行実行
  - [ ] 複数プロセスでの実行
  - [ ] ロック機構の確認
````

次に、`references/todo.md`を更新します。

````markdown:references/todo.md
# 実装ToDo

## 1. generate_input.py
- [x] コマンドライン引数の処理
  - [x] argparseを使用したオプションの設定
  - [x] デフォルト値の設定（2S=1, Δ=1.0, sizes=[4,6,8,10,12]）
  - [x] サイズリストの文字列からリストへの変換

- [x] 作業ディレクトリの管理
  - [x] デフォルト（カレントディレクトリ）または指定ディレクトリの確認
  - [x] data/ディレクトリの作成
  - [x] 各サイズのディレクトリ作成

- [x] StdFace.defの生成
  - [x] テンプレート文字列の作成
  - [x] 各サイズごとのファイル生成
  - [x] パラメータの妥当性チェック（2S > 0）

## 2. run_calculations.py
- [x] コマンドライン引数の処理
  - [x] argparseを使用したwork-dirオプションの設定
  - [x] HPhi実行ファイルのパス設定

- [x] 計算の実行
  - [x] data/ディレクトリ内のN*ディレクトリの検索
  - [x] 各ディレクトリでのHPhi実行
  - [x] 進捗状況の表示

- [x] 結果の管理
  - [x] results/raw/ディレクトリの作成
  - [x] 計算結果の移動
  - [x] エラー時のハンドリング

## 3. analyze_results.py
- [ ] コマンドライン引数の処理
  - [ ] argparseを使用したwork-dirオプションの設定

- [ ] データ読み込み
  - [ ] results/raw/内の各サイズディレクトリからzvo_energy.datを読み込み
  - [ ] エネルギー値の抽出（E₀, E₁）

- [ ] データ処理
  - [ ] エネルギーギャップの計算（Δ = E₁ - E₀）
  - [ ] サイズごとのデータ整理
  - [ ] energy_gap.datファイルの生成

- [ ] プロット生成
  - [ ] matplotlibを使用したプロット
  - [ ] x軸（1/N）とy軸（Δ）の設定
  - [ ] グラフの体裁整備
  - [ ] PDFファイルとして保存

## 追加の改善事項
- [ ] タイムアウト処理の実装
- [ ] 並行実行のサポート
- [ ] ログ機能の強化
- [ ] エラー時のバックアップ機能
````

次のアクションとして、以下の3つの選択肢を提案します：

1. `analyze_results.py`の実装
   - テスト戦略の作成
   - テストコードの実装
   - スクリプトの実装

2. 現在のスクリプトの改善
   - タイムアウト処理の追加
   - 並行実行のサポート
   - ログ機能の強化

3. ドキュメントの整備
   - READMEの作成
   - 使用例の追加
   - インストール手順の記載

どの方向で進めるのがよいでしょうか？個人的には、基本機能の実装を完了させる観点から、`analyze_results.py`の実装を優先することをお勧めします。


