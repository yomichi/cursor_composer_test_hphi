# analyze_results.py のテスト戦略

## 1. ユニットテスト

### コマンドライン引数のパース（`test_parse_args`）
- デフォルト値の確認
  - `--work-dir`が`.`になっているか
- 各引数の型の確認
  - `work_dir`が文字列型か
- 不正な入力のエラー処理
  - 存在しないディレクトリを指定した場合

### 結果ディレクトリの検索（`test_find_result_dirs`）
- 正常系
  - `results/raw/N*`ディレクトリの検出
  - ディレクトリのソート順の確認（N4, N6, N8, ...）
- 異常系
  - 結果ディレクトリが存在しない場合
  - 計算結果が見つからない場合

### エネルギー値の読み込み（`test_read_energies`）
- 正常系
  - エネルギーファイルの読み込み
  - 基底状態と第一励起状態のエネルギー抽出
  - 数値の型と精度の確認
- 異常系
  - ファイルが存在しない場合
  - ファイルフォーマットが不正な場合
  - エネルギー値の順序が不正な場合（E₁ < E₀）

### エネルギーギャップの計算（`test_calculate_gaps`）
- 正常系
  - ギャップの計算（Δ = E₁ - E₀）
  - 複数サイズのデータ処理
  - 結果のデータ構造確認
- 異常系
  - 負のギャップが計算された場合
  - データが不完全な場合

### データファイルの生成（`test_write_gap_data`）
- 正常系
  - energy_gap.datの生成
  - ファイルフォーマットの確認
  - 数値の精度確認
- 異常系
  - 書き込み権限がない場合
  - ディスク容量不足の場合

### プロット生成（`test_create_plot`）
- 正常系
  - プロットファイルの生成
  - 軸ラベルとスケールの確認
  - データ点とフィッティングの確認
- 異常系
  - データ点が少なすぎる場合
  - 異常値が含まれる場合

## 2. 統合テスト

### メイン処理の実行（`test_main`）
- 正常系
  - 全体の処理フローの確認
  - 出力ファイルの生成確認
  - プロットの生成確認
- 異常系
  - データ読み込みエラー時の処理
  - プロット生成エラー時の処理

## 3. テストケースの優先順位

### 1. 基本機能のテスト
- [ ] コマンドライン引数の処理
  - [ ] デフォルト値の確認
  - [ ] カスタム値の確認
  - [ ] 型の確認
- [ ] データ読み込みの基本機能
  - [ ] ファイル読み込み
  - [ ] エネルギー値の抽出

### 2. データ処理
- [ ] エネルギーギャップの計算
  - [ ] 基本的な計算
  - [ ] エッジケースの処理
- [ ] データの整理
  - [ ] サイズ順のソート
  - [ ] 不完全なデータの処理

### 3. 出力生成
- [ ] データファイルの生成
  - [ ] フォーマットの確認
  - [ ] 数値の精度
- [ ] プロットの生成
  - [ ] 基本的なプロット
  - [ ] 体裁の調整

### 4. エッジケース
- [ ] 異常データの処理
  - [ ] 不正なファイル形式
  - [ ] 異常値の検出
- [ ] リソース制限
  - [ ] メモリ使用量
  - [ ] ディスク容量

## 4. テストデータの準備

### サンプルデータ
```
# zvo_energy.dat の例
Energy  0  -8.12345678
Energy  1  -7.98765432

# energy_gap.dat の期待される形式
# N      E0          E1          Gap
  4     -8.12345678 -7.98765432  0.13580246
  6     -12.1234568 -11.9876543  0.13580246
  8     -16.1234568 -15.9876543  0.13580246
``` 
