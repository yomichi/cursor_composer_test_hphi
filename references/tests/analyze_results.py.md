# analyze_results.py のテスト戦略

## 1. ユニットテスト

### コマンドライン引数のパース（`test_parse_args`）
- デフォルト値の確認
  - `--work-dir`が`.`になっているか
  - `--format`が`pdf`になっているか
- 各引数の型の確認
  - `work_dir`が文字列型か
  - `format`が文字列型か
- 不正な入力のエラー処理
  - 存在しないディレクトリを指定した場合
  - サポートされていないフォーマットを指定した場合
  - フォーマットの重複指定

### 結果ディレクトリの検索（`test_find_result_dirs`）
- 正常系
  - `results/raw/N*`ディレクトリの検出
  - ディレクトリのソート順の確認（N4, N6, N8, ...）
- 異常系
  - 結果ディレクトリが存在しない場合
  - 計算結果が見つからない場合

### エネルギー値の読み込み（`test_read_energies`）
- 正常系
  - エネルギーファイルの読み込み
  - `State 0`と`State 1`のブロックからのエネルギー値抽出
  - `Energy`行からの数値抽出と型変換
  - 数値の型と精度の確認（10桁の浮動小数点数）
- 異常系
  - ファイルが存在しない場合
  - ファイルフォーマットが不正な場合
    - `State`ブロックが見つからない
    - `Energy`行が見つからない
    - エネルギー値が数値として解釈できない
  - エネルギー値の順序が不正な場合（E₁ < E₀）
  - 必要な状態数（State 0とState 1）が見つからない場合

### エネルギーギャップの計算（`test_calculate_gaps`）
- 正常系
  - ギャップの計算（Δ = E₁ - E₀）
  - 複数サイズのデータ処理
  - 結果のデータ構造確認
- 異常系
  - 負のギャップが計算された場合
  - データが不完全な場合

### データファイルの生成（`test_write_gap_data`）
- 正常系
  - energy_gap.datの生成
  - ファイルフォーマットの確認
  - 数値の精度確認
- 異常系
  - 書き込み権限がない場合
  - ディスク容量不足の場合

### プロット生成（`test_create_plot`）
- 正常系
  - プロットファイルの生成
  - 軸ラベルとスケールの確認
  - データ点とフィッティングの確認
  - 複数フォーマットでの出力
    - PDFフォーマット（デフォルト）
    - PNGフォーマット（指定時）
    - 複数フォーマット同時出力
- 異常系
  - データ点が少なすぎる場合
  - 異常値が含まれる場合
  - 出力ファイルの書き込み権限がない場合

## 2. 統合テスト

### メイン処理の実行（`test_main`）
- 正常系
  - 全体の処理フローの確認
  - 出力ファイルの生成確認
  - プロットの生成確認
- 異常系
  - データ読み込みエラー時の処理
  - プロット生成エラー時の処理

## 3. テストケースの優先順位

### 1. 基本機能のテスト
- [x] コマンドライン引数の処理
  - [x] デフォルト値の確認
  - [x] カスタム値の確認
  - [x] 型の確認
- [x] データ読み込みの基本機能
  - [x] ファイル読み込み
  - [x] エネルギー値の抽出

### 2. データ処理
- [x] エネルギーギャップの計算
  - [x] 基本的な計算
  - [x] エッジケースの処理
- [x] データの整理
  - [x] サイズ順のソート
  - [x] 不完全なデータの処理

### 3. 出力生成
- [x] データファイルの生成
  - [x] フォーマットの確認
  - [x] 数値の精度
- [x] プロットの生成
  - [x] 基本的なプロット
  - [x] 体裁の調整

### 4. エッジケース
- [x] 異常データの処理
  - [x] 不正なファイル形式
  - [x] 異常値の検出
- [ ] リソース制限
  - [ ] メモリ使用量
  - [ ] ディスク容量

## 4. テストデータの準備

### サンプルデータ
```
# zvo_energy.dat の例（method=CG）
State 0
  Energy  -7.1043675920
  Doublon  0.4164356536
  Sz  0.0000000000

State 1
  Energy  -6.9876543210
  Doublon  0.3987654321
  Sz  0.0000000000

# energy_gap.dat の期待される形式
# N      E0          E1          Gap
  4     -7.10436759 -6.98765432  0.11671327
  6     -12.1234568 -11.9876543  0.13580246
  8     -16.1234568 -15.9876543  0.13580246
``` 
