# run_calculations.py のテスト戦略

## 1. ユニットテスト

### コマンドライン引数のパース（`test_parse_args`）
- デフォルト値の確認
  - `--work-dir`が`.`になっているか
  - `--hphi`が`HPhi`になっているか
- 各引数の型の確認
  - `work_dir`が文字列型か
  - `hphi`が文字列型か
- 不正な入力のエラー処理
  - 存在しないディレクトリを指定した場合
  - 実行権限のないHPhiを指定した場合

### 計算ディレクトリの検索（`test_find_calc_dirs`）
- 正常系
  - `data/N*`ディレクトリの検出
  - ディレクトリのソート順の確認
- 異常系
  - データディレクトリが存在しない場合
  - 計算ディレクトリが見つからない場合

### HPhi実行（`test_run_hphi`）
- 正常系
  - HPhi実行時の戻り値の確認
  - 出力ファイルの生成確認
- 異常系
  - HPhi実行失敗時のエラー処理
  - タイムアウト時の処理

### 結果の移動（`test_move_results`）
- 正常系
  - 結果ファイルの移動確認
  - ディレクトリ構造の確認
- 異常系
  - 移動先ディレクトリの作成失敗
  - 結果ファイルが存在しない場合

## 2. 統合テスト

### メイン処理の実行（`test_main`）
- 正常系
  - 全体の処理フローの確認
  - 結果ファイルの配置確認
- 異常系
  - HPhi実行エラー時の処理
  - 途中でのエラー発生時の後処理

## 3. テストケースの優先順位

### 1. 基本機能のテスト
- [ ] コマンドライン引数の処理
  - [ ] デフォルト値の確認
  - [ ] カスタム値の確認
  - [ ] 型の確認
- [ ] HPhi実行の基本機能
  - [ ] コマンド実行
  - [ ] 出力ファイルの確認

### 2. 入力値の検証
- [ ] パラメータの妥当性チェック
  - [ ] 作業ディレクトリの存在確認
  - [ ] HPhi実行ファイルの確認
- [ ] エラー処理
  - [ ] 不正なパス
  - [ ] 権限エラー

### 3. ファイルシステム操作
- [ ] 結果ディレクトリの作成
  - [ ] ディレクトリ構造の作成
  - [ ] 既存ディレクトリの処理
- [ ] 結果ファイルの移動
  - [ ] ファイルの移動確認
  - [ ] 移動後の内容確認

### 4. エッジケース
- [ ] 実行時エラー
  - [ ] HPhi実行失敗
  - [ ] タイムアウト
  - [ ] 中断処理
- [ ] 並行実行
  - [ ] 複数プロセスでの実行
  - [ ] ロック機構の確認 
